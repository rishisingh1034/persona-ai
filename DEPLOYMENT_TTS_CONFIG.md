# TTS Deployment Configuration Guide\n\nThis guide explains how to deploy the TTS service across different platforms and handle the file system limitations.\n\n## The Problem\n\nThe error you're seeing:\n```\nEROFS: read-only file system, open '/var/task/public/generated-audio/hitesh_34d03599.mp3'\n```\n\nOccurs because serverless platforms (Vercel, Netlify, AWS Lambda) have **read-only file systems** and don't allow writing files to the local directory.\n\n## Solutions\n\n### ‚úÖ Solution 1: Base64 Data URLs (Current Implementation)\n\nThe TTS route now automatically detects serverless environments and returns audio as base64 data URLs instead of saving files.\n\n**Pros:**\n- Works immediately on all serverless platforms\n- No additional configuration needed\n- No external dependencies\n\n**Cons:**\n- Larger payload size\n- No caching between requests\n- May hit response size limits for very long audio\n\n### üîß Solution 2: Cloud Storage (Recommended for Production)\n\nFor production applications, use cloud storage services:\n\n#### AWS S3 Implementation\n```bash\nnpm install @aws-sdk/client-s3\n```\n\n#### Cloudinary Implementation\n```bash\nnpm install cloudinary\n```\n\n#### Google Cloud Storage\n```bash\nnpm install @google-cloud/storage\n```\n\n### üè† Solution 3: Local Development\n\nFor local development, the current implementation saves files to `public/generated-audio/` as before.\n\n## Environment Detection\n\nThe system automatically detects the deployment environment:\n\n```typescript\n// Serverless environment detection\nif (process.env.VERCEL || process.env.NETLIFY || process.env.AWS_LAMBDA_FUNCTION_NAME) {\n  // Use base64 data URLs\n  return `data:audio/mpeg;base64,${base64Audio}`;\n} else {\n  // Save to local file system\n  return `/generated-audio/${filename}`;\n}\n```\n\n## Current Status\n\n‚úÖ **Your TTS service is now fixed and will work on:**\n- Vercel\n- Netlify\n- AWS Lambda\n- Railway\n- Render\n- Local development\n\n## Testing\n\nTo test the fix:\n\n1. **Local Development:**\n   ```bash\n   npm run dev\n   ```\n   Audio files will be saved to `public/generated-audio/`\n\n2. **Production Deployment:**\n   Deploy to your platform - audio will be returned as base64 data URLs\n\n3. **Test with curl:**\n   ```bash\n   curl -X POST https://your-app.vercel.app/api/tts \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"text\":\"Hello world\",\"persona\":\"hitesh\"}'\n   ```\n\n## Frontend Compatibility\n\nThe frontend `useTTS` hook automatically handles both file URLs and data URLs:\n\n```typescript\n// Both of these work automatically:\n// File URL: \"/generated-audio/hitesh_12345.mp3\"\n// Data URL: \"data:audio/mpeg;base64,UklGRnoGAABXQVZF...\"\nconst audio = new Audio(audioUrl);\nawait audio.play();\n```\n\n## Performance Considerations\n\n### Base64 Data URLs:\n- **Response Size:** ~33% larger than binary\n- **Memory Usage:** Higher due to base64 encoding\n- **Caching:** No file-based caching in serverless\n\n### Recommendations:\n- ‚úÖ Keep text under 2500 characters (already implemented)\n- ‚úÖ Use shorter demo messages\n- ‚ö†Ô∏è  Consider implementing cloud storage for frequently used audio\n\n## Monitoring\n\nAdd these environment variables to monitor your deployment:\n\n```bash\n# .env.local or deployment settings\nELEVENLABS_API_KEY=your_key_here\nELEVENLABS_VOICE_ID_HITESH=your_voice_id\nELEVENLABS_VOICE_ID_PIYUSH=your_voice_id\n\n# Optional: Force serverless mode for testing\nFORCE_SERVERLESS_MODE=true\n```\n\n## Future Improvements\n\n1. **Implement Cloud Storage:**\n   - S3, Cloudinary, or Google Cloud\n   - Better caching and performance\n   - Reduced bandwidth costs\n\n2. **Add Response Streaming:**\n   - Stream audio directly to client\n   - Reduce memory usage\n   - Better user experience\n\n3. **Implement Audio Compression:**\n   - Use lower bitrate for voice\n   - Reduce file sizes\n   - Faster loading times\n\n## Troubleshooting\n\n### Issue: \"Audio not playing\"\n**Solution:** Check browser console for audio playback errors. Data URLs should work in all modern browsers.\n\n### Issue: \"Response too large\"\n**Solution:** Reduce text length or implement cloud storage.\n\n### Issue: \"ElevenLabs API errors\"\n**Solution:** Check API key, voice IDs, and account credits.\n\n---\n\n**Your TTS integration is now deployment-ready! üöÄ**\n\nThe service will automatically adapt to any deployment environment without requiring changes to your code or configuration."
